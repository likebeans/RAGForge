# Self-RAG Pipeline å‰ç«¯ UI å¼€å‘æ–¹æ¡ˆ

> å‚è€ƒé¡¹ç›®ï¼š[rag-web-ui](https://github.com/rag-web-ui/rag-web-ui) | [Open WebUI](https://github.com/open-webui/open-webui) | [Ant Design](https://ant.design)

---

## ã€‡ã€è®¾è®¡ä»·å€¼è§‚ä¸è§„èŒƒï¼ˆåŸºäº Ant Designï¼‰

### 0.1 å››å¤§è®¾è®¡ä»·å€¼è§‚

| ä»·å€¼è§‚ | æ ¸å¿ƒç†å¿µ | åœ¨æœ¬é¡¹ç›®ä¸­çš„åº”ç”¨ |
|--------|----------|------------------|
| **è‡ªç„¶** | é™ä½è®¤çŸ¥æˆæœ¬ï¼Œç¬¦åˆç”¨æˆ·ç›´è§‰ | èŠå¤©ç•Œé¢æ¨¡æ‹ŸçœŸå®å¯¹è¯åœºæ™¯ï¼›æ“ä½œåé¦ˆå³æ—¶è‡ªç„¶ |
| **ç¡®å®šæ€§** | ä¿æŒå…‹åˆ¶ï¼Œæ¨¡å—åŒ–è®¾è®¡ | ç»Ÿä¸€çš„ç»„ä»¶åº“ï¼›ä¸€è‡´çš„äº¤äº’æ¨¡å¼ï¼›å¯é¢„æµ‹çš„è¡Œä¸º |
| **æ„ä¹‰æ„Ÿ** | æ˜ç¡®ç›®æ ‡ï¼Œå³æ—¶åé¦ˆ | æ¸…æ™°çš„æ“ä½œç»“æœæç¤ºï¼›è¿›åº¦å¯è§†åŒ–ï¼›é”™è¯¯å¼•å¯¼ |
| **ç”Ÿé•¿æ€§** | ä»·å€¼è¿æ¥ï¼Œäººæœºå…±ç”Ÿ | æ¸è¿›å¼åŠŸèƒ½å±•ç¤ºï¼›ä¸ªæ€§åŒ–é…ç½®ï¼›å†å²è®°å½•æ²‰æ·€ |

### 0.2 å¸ƒå±€è§„èŒƒ

#### ç½‘æ ¼ç³»ç»Ÿ
- **åŸºç¡€å•ä½**: 8pxï¼ˆæ‰€æœ‰é—´è·ã€å°ºå¯¸éµå¾ª 8 çš„å€æ•°ï¼‰
- **æ …æ ¼ä½“ç³»**: 24 æ …æ ¼ï¼ˆé€‚é…ä¸åŒå±å¹•å°ºå¯¸ï¼‰
- **å¶æ•°åŸåˆ™**: å°ºå¯¸æ•°å€¼ä¼˜å…ˆä½¿ç”¨å¶æ•°

#### å¸¸ç”¨é—´è·æ¨¡åº¦
```
4px   - ç´§å‡‘é—´è·ï¼ˆå›¾æ ‡ä¸æ–‡å­—ï¼‰
8px   - åŸºç¡€é—´è·ï¼ˆç»„ä»¶å†…éƒ¨ï¼‰
16px  - æ ‡å‡†é—´è·ï¼ˆç»„ä»¶ä¹‹é—´ï¼‰
24px  - ä¸­ç­‰é—´è·ï¼ˆæ¨¡å—ä¹‹é—´ï¼‰
32px  - å®½æ¾é—´è·ï¼ˆåŒºå—ä¹‹é—´ï¼‰
48px  - å¤§é—´è·ï¼ˆé¡µé¢çº§åˆ†éš”ï¼‰
```

#### å“åº”å¼æ–­ç‚¹
```
xs: < 576px   (æ‰‹æœºç«–å±)
sm: â‰¥ 576px  (æ‰‹æœºæ¨ªå±)
md: â‰¥ 768px  (å¹³æ¿)
lg: â‰¥ 992px  (æ¡Œé¢)
xl: â‰¥ 1200px (å¤§å±)
2xl: â‰¥ 1600px (è¶…å¤§å±)
```

### 0.3 è‰²å½©è§„èŒƒ

#### ä¸»è‰²è°ƒ
```css
--primary: hsl(221.2, 83.2%, 53.3%);      /* å“ç‰Œè“ */
--primary-hover: hsl(221.2, 83.2%, 45%);  /* æ‚¬åœæ€ */
--primary-active: hsl(221.2, 83.2%, 40%); /* æ¿€æ´»æ€ */
```

#### åŠŸèƒ½è‰²
```css
--success: hsl(142.1, 76.2%, 36.3%);  /* æˆåŠŸ/å®Œæˆ */
--warning: hsl(38, 92%, 50%);         /* è­¦å‘Š/æç¤º */
--error: hsl(0, 84.2%, 60.2%);        /* é”™è¯¯/å±é™© */
--info: hsl(221.2, 83.2%, 53.3%);     /* ä¿¡æ¯/é“¾æ¥ */
```

#### ä¸­æ€§è‰²ï¼ˆæµ…è‰²/æ·±è‰²æ¨¡å¼è‡ªé€‚åº”ï¼‰
```css
--background: 0 0% 100% / 0 0% 3.9%;
--foreground: 0 0% 3.9% / 0 0% 98%;
--muted: 0 0% 96.1% / 0 0% 14.9%;
--border: 0 0% 89.8% / 0 0% 14.9%;
```

### 0.4 å­—ä½“è§„èŒƒ

#### å­—ä½“æ—
```css
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 
             'Helvetica Neue', Arial, 'Noto Sans', sans-serif,
             'Apple Color Emoji', 'Segoe UI Emoji';
```

#### å­—å·å±‚çº§
| ç”¨é€” | å­—å· | è¡Œé«˜ | å­—é‡ |
|------|------|------|------|
| é¡µé¢æ ‡é¢˜ | 24px | 32px | 600 |
| æ¨¡å—æ ‡é¢˜ | 18px | 28px | 600 |
| æ­£æ–‡ | 14px | 22px | 400 |
| è¾…åŠ©æ–‡å­— | 12px | 20px | 400 |
| æ ‡ç­¾/Badge | 12px | 16px | 500 |

### 0.5 åŠ¨æ•ˆè§„èŒƒ

#### æ—¶é•¿æ ‡å‡†
```css
--duration-fast: 100ms;    /* å¾®äº¤äº’ï¼ˆhoverã€focusï¼‰ */
--duration-normal: 200ms;  /* æ ‡å‡†è¿‡æ¸¡ï¼ˆå±•å¼€ã€æ”¶èµ·ï¼‰ */
--duration-slow: 300ms;    /* å¤æ‚åŠ¨ç”»ï¼ˆé¡µé¢åˆ‡æ¢ï¼‰ */
```

#### ç¼“åŠ¨å‡½æ•°
```css
--ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);  /* é»˜è®¤ */
--ease-out: cubic-bezier(0, 0, 0.2, 1);       /* è¿›å…¥ */
--ease-in: cubic-bezier(0.4, 0, 1, 1);        /* é€€å‡º */
```

### 0.6 ç»„ä»¶è®¾è®¡åŸåˆ™

1. **ä¿æŒå…‹åˆ¶**: ç”¨æœ€å°‘çš„å…ƒç´ è¡¨è¾¾åŠŸèƒ½ï¼Œé¿å…è¿‡åº¦è®¾è®¡
2. **ä¸€è‡´æ€§**: åŒç±»æ“ä½œä½¿ç”¨ç›¸åŒçš„äº¤äº’æ¨¡å¼
3. **å³æ—¶åé¦ˆ**: æ“ä½œåç«‹å³ç»™äºˆè§†è§‰/å¬è§‰åé¦ˆ
4. **å®¹é”™è®¾è®¡**: æä¾›æ’¤é”€ã€ç¡®è®¤ç­‰é˜²è¯¯æ“ä½œæœºåˆ¶
5. **æ¸è¿›æŠ«éœ²**: å¤æ‚åŠŸèƒ½åˆ†å±‚å±•ç¤ºï¼Œé™ä½åˆæ¬¡ä½¿ç”¨é—¨æ§›

---

## ä¸€ã€å‚è€ƒé¡¹ç›®åˆ†æ

### 1.1 rag-web-ui ç‰¹ç‚¹

| ç‰¹æ€§ | å®ç°æ–¹å¼ |
|------|----------|
| **æŠ€æœ¯æ ˆ** | Next.js 14 + TypeScript + Tailwind + shadcn/ui + Vercel AI SDK |
| **çŸ¥è¯†åº“ç®¡ç†** | Dashboard å¡ç‰‡å¼å±•ç¤ºï¼Œæ”¯æŒåˆ›å»º/åˆ é™¤ |
| **æ–‡æ¡£å¤„ç†** | å¼‚æ­¥ä¸Šä¼  â†’ Job ID â†’ è½®è¯¢çŠ¶æ€ â†’ å®Œæˆæç¤º |
| **æ™ºèƒ½å¯¹è¯** | å¤šè½®ä¸Šä¸‹æ–‡ + **å¼•ç”¨æ¥æºæ ‡æ³¨** |
| **API Key ç®¡ç†** | ç‹¬ç«‹é¡µé¢ç®¡ç†ï¼Œæ”¯æŒåˆ›å»º/æ’¤é”€ |

**äº®ç‚¹**ï¼š
- æ–‡æ¡£å¤„ç†è¿›åº¦å¯è§†åŒ–ï¼ˆProcessing/Completed/Failedï¼‰
- å¯¹è¯å›ç­”ä¸­æ˜¾ç¤º**å¼•ç”¨ç‰‡æ®µ**å’Œæ¥æºæ–‡æ¡£

### 1.2 Open WebUI ç‰¹ç‚¹

| ç‰¹æ€§ | å®ç°æ–¹å¼ |
|------|----------|
| **æŠ€æœ¯æ ˆ** | SvelteKitï¼ˆSvelte 5ï¼‰+ TypeScript + Tailwind |
| **å“åº”å¼** | æ¡Œé¢/ç§»åŠ¨ç«¯è‡ªé€‚åº”ï¼ŒPWA æ”¯æŒ |
| **RAG é›†æˆ** | ä½¿ç”¨ `#` å‘½ä»¤å¼•ç”¨æ–‡æ¡£æˆ– URL |
| **å¤šæ¨¡å‹** | åŒæ—¶å¯¹è¯å¤šä¸ªæ¨¡å‹ï¼Œå¯¹æ¯”è¾“å‡º |
| **æƒé™æ§åˆ¶** | RBAC è§’è‰²æƒé™ï¼Œç®¡ç†å‘˜/ç”¨æˆ·åˆ†ç¦» |

**äº®ç‚¹**ï¼š
- æä½³çš„ç§»åŠ¨ç«¯ä½“éªŒ
- å®Œæ•´çš„ Markdown/LaTeX æ¸²æŸ“
- èŠå¤©å†å²æŒä¹…åŒ–
- æ¨¡å‹åˆ‡æ¢å™¨

---

## äºŒã€Self-RAG Pipeline åŠŸèƒ½æ¸…å•

### 2.1 åç«¯å·²æ”¯æŒçš„åŠŸèƒ½

| æ¨¡å— | API ç«¯ç‚¹ | åŠŸèƒ½æè¿° |
|------|----------|----------|
| **å¥åº·æ£€æŸ¥** | `GET /health` | æœåŠ¡çŠ¶æ€ |
| **çŸ¥è¯†åº“** | `GET/POST /v1/knowledge-bases` | åˆ—è¡¨/åˆ›å»º |
| | `DELETE /v1/knowledge-bases/{id}` | åˆ é™¤ |
| **æ–‡æ¡£** | `GET /v1/knowledge-bases/{id}/documents` | æ–‡æ¡£åˆ—è¡¨ |
| | `POST /v1/knowledge-bases/{id}/documents` | ä¸Šä¼ æ–‡æœ¬ |
| | `POST /v1/knowledge-bases/{id}/documents/upload` | ä¸Šä¼ æ–‡ä»¶ |
| | `POST /v1/knowledge-bases/{id}/documents/batch` | æ‰¹é‡ä¸Šä¼  |
| | `POST /v1/knowledge-bases/{id}/documents/advanced-batch` | é«˜çº§æ‰¹é‡ä¸Šä¼ ï¼ˆè‡ªå®šä¹‰é…ç½®ï¼‰ |
| | `DELETE /v1/documents/{id}` | åˆ é™¤æ–‡æ¡£ |
| **æ£€ç´¢** | `POST /v1/retrieve` | è¯­ä¹‰æ£€ç´¢ï¼ˆå¤šæ£€ç´¢å™¨ï¼‰ |
| **RAG** | `POST /v1/rag` | RAG ç”Ÿæˆ |
| **å¢å¼ºé¢„è§ˆ** | `POST /v1/enrichment/preview-summary` | é¢„è§ˆæ–‡æ¡£æ‘˜è¦ |
| | `POST /v1/enrichment/preview-chunk-enrichment` | é¢„è§ˆ Chunk å¢å¼º |
| **OpenAI** | `POST /v1/chat/completions` | OpenAI å…¼å®¹å¯¹è¯ |
| | `POST /v1/embeddings` | å‘é‡åŒ– |
| **API Key** | `GET/POST/DELETE /v1/api-keys/*` | Key ç®¡ç† |
| **Admin** | `/admin/tenants/*` | ç§Ÿæˆ·ç®¡ç† |

### 2.3 å¢å¼ºé¢„è§ˆä¸é«˜çº§å…¥åº“ API

**é¢„è§ˆæ–‡æ¡£æ‘˜è¦** (`POST /v1/enrichment/preview-summary`):
```json
{
  "content": "æ–‡æ¡£å†…å®¹...",
  "title": "æ–‡æ¡£æ ‡é¢˜",
  "max_tokens": 300
}
```

**é¢„è§ˆ Chunk å¢å¼º** (`POST /v1/enrichment/preview-chunk-enrichment`):
```json
{
  "chunks": ["chunk1 æ–‡æœ¬", "chunk2 æ–‡æœ¬"],
  "doc_title": "æ–‡æ¡£æ ‡é¢˜",
  "doc_summary": "æ–‡æ¡£æ‘˜è¦",
  "max_tokens": 512
}
```

**é«˜çº§æ‰¹é‡å…¥åº“** (`POST /v1/knowledge-bases/{id}/documents/advanced-batch`):
```json
{
  "documents": [{"title": "...", "content": "..."}],
  "chunker": {"name": "recursive", "params": {"chunk_size": 500}},
  "generate_summary": true,
  "enrich_chunks": true,
  "embedding_provider": "ollama",
  "embedding_model": "bge-m3"
}
```

### 2.2 å¤šæ£€ç´¢å™¨æ”¯æŒ

```
dense      - ç¨ å¯†å‘é‡æ£€ç´¢
bm25       - BM25 ç¨€ç–æ£€ç´¢
hybrid     - æ··åˆæ£€ç´¢ï¼ˆæ¨èï¼‰
hyde       - HyDE å‡è®¾æ–‡æ¡£åµŒå…¥
fusion     - RRF èåˆ + å¯é€‰ Rerank
multi_query - å¤šæŸ¥è¯¢æ‰©å±•
```

---

## ä¸‰ã€UI å¸ƒå±€è®¾è®¡

### 3.1 æ•´ä½“æ¶æ„ï¼ˆå‚è€ƒ rag-web-ui + Open WebUIï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header: Logo + å¯¼èˆª + ç”¨æˆ·/è®¾ç½®                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚                                                  â”‚
â”‚   Sidebar    â”‚              Main Content                        â”‚
â”‚              â”‚                                                  â”‚
â”‚  â€¢ æ–°å»ºå¯¹è¯   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â€¢ å†å²è®°å½•   â”‚   â”‚  èŠå¤©ç•Œé¢ / çŸ¥è¯†åº“ç®¡ç† / æ–‡æ¡£ç®¡ç†        â”‚   â”‚
â”‚  â€¢ çŸ¥è¯†åº“     â”‚   â”‚                                          â”‚   â”‚
â”‚  â€¢ è®¾ç½®      â”‚   â”‚                                          â”‚   â”‚
â”‚              â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              â”‚                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Footer: çŠ¶æ€æ ï¼ˆè¿æ¥çŠ¶æ€/æ¨¡å‹ä¿¡æ¯ï¼‰                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 é¡µé¢è§„åˆ’

| é¡µé¢ | è·¯ç”± | åŠŸèƒ½ |
|------|------|------|
| **å¯¹è¯** | `/` æˆ– `/chat` | ä¸»èŠå¤©ç•Œé¢ |
| **å¯¹è¯è¯¦æƒ…** | `/chat/[id]` | ç‰¹å®šå¯¹è¯å†å² |
| **çŸ¥è¯†åº“** | `/knowledge` | çŸ¥è¯†åº“åˆ—è¡¨/åˆ›å»º |
| **çŸ¥è¯†åº“è¯¦æƒ…** | `/knowledge/[id]` | æ–‡æ¡£ç®¡ç†/ä¸Šä¼  |
| **è®¾ç½®** | `/settings` | API é…ç½®/æ£€ç´¢å™¨è®¾ç½® |
| **API Keys** | `/settings/api-keys` | Key ç®¡ç†ï¼ˆadminï¼‰ |

---

## å››ã€åŠŸèƒ½æ¨¡å—è¯¦ç»†è®¾è®¡

### 4.1 å¯¹è¯ç•Œé¢ï¼ˆæ ¸å¿ƒï¼‰

**å‚è€ƒ**: Open WebUI çš„èŠå¤©å¸ƒå±€ + rag-web-ui çš„å¼•ç”¨å±•ç¤º + Ant Design å¯¹è¯å¼ AI ç»„ä»¶

#### è®¾è®¡åŸåˆ™ï¼ˆåŸºäº Ant Design ä»·å€¼è§‚ï¼‰

| åŸåˆ™ | å®ç°æ–¹å¼ |
|------|----------|
| **è‡ªç„¶å¯¹è¯** | æ°”æ³¡å¼å¸ƒå±€ï¼Œæ¨¡æ‹ŸçœŸå®èŠå¤©åœºæ™¯ï¼›æµå¼è¾“å‡ºæ¨¡æ‹Ÿæ‰“å­—æ•ˆæœ |
| **å³æ—¶åé¦ˆ** | å‘é€åç«‹å³æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯ï¼›åŠ è½½çŠ¶æ€æ¸…æ™°å¯è§ï¼›é”™è¯¯æç¤ºå‹å¥½ |
| **ä¿¡æ¯å±‚çº§** | ä¸»å›ç­”çªå‡ºï¼Œå¼•ç”¨æ¥æºå¯æŠ˜å ï¼›é‡è¦æ“ä½œå‰ç½®ï¼Œè¾…åŠ©åŠŸèƒ½æ”¶æ•› |
| **ä¸€è‡´ä½“éªŒ** | æ¶ˆæ¯æ°”æ³¡ã€æŒ‰é’®ã€å›¾æ ‡é£æ ¼ç»Ÿä¸€ï¼›äº¤äº’æ¨¡å¼å¯é¢„æµ‹ |

#### æ¶ˆæ¯æ°”æ³¡è§„èŒƒ

```
ç”¨æˆ·æ¶ˆæ¯                              åŠ©æ‰‹æ¶ˆæ¯
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åœ†è§’: 16px             â”‚          â”‚  åœ†è§’: 16px             â”‚
â”‚  å³ä¸Šè§’åœ†è§’: 4px        â”‚          â”‚  å·¦ä¸Šè§’åœ†è§’: 4px        â”‚
â”‚  èƒŒæ™¯: primary          â”‚          â”‚  èƒŒæ™¯: muted            â”‚
â”‚  æ–‡å­—: primary-foregroundâ”‚          â”‚  æ–‡å­—: foreground       â”‚
â”‚  æœ€å¤§å®½åº¦: 80%          â”‚          â”‚  æœ€å¤§å®½åº¦: 80%          â”‚
â”‚  å†…è¾¹è·: 12px 16px      â”‚          â”‚  å†…è¾¹è·: 12px 16px      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å¤´åƒè§„èŒƒ
- **å°ºå¯¸**: 32px x 32px
- **åœ†è§’**: å®Œå…¨åœ†å½¢ (50%)
- **ç”¨æˆ·å¤´åƒ**: å“ç‰Œä¸»è‰²èƒŒæ™¯ + ç™½è‰²é¦–å­—æ¯/å›¾æ ‡
- **åŠ©æ‰‹å¤´åƒ**: æµ…è‰²èƒŒæ™¯ + è¾¹æ¡† + AI å›¾æ ‡

```tsx
// æ¶ˆæ¯ç»“æ„
interface Message {
  id: string;
  role: "user" | "assistant";
  content: string;
  timestamp: Date;
  // RAG ç‰¹æœ‰å­—æ®µ
  sources?: Source[];      // å¼•ç”¨æ¥æº
  retriever?: string;      // ä½¿ç”¨çš„æ£€ç´¢å™¨
  model?: string;          // LLM æ¨¡å‹
}

interface Source {
  text: string;
  score: number;
  document_title: string;
  chunk_id: string;
}
```

**UI ç»„ä»¶**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çŸ¥è¯†åº“é€‰æ‹©: [ä¸‹æ‹‰å¤šé€‰] â”‚ æ£€ç´¢å™¨: [Hybrid â–¼] â”‚ Top-K: [5] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  [User]  è¯·è§£é‡Šä¸€ä¸‹è¯é£ŸåŒæºçš„ç›¸å…³æ³•è§„                    â”‚
â”‚                                                         â”‚
â”‚  [AI]    æ ¹æ®æ£€ç´¢åˆ°çš„æ–‡æ¡£ï¼Œè¯é£ŸåŒæºç‰©å“...               â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚          â”‚ ğŸ“„ å¼•ç”¨æ¥æº (3)                      â”‚        â”‚
â”‚          â”‚ â€¢ å›½å®¶å«ç”Ÿå¥åº·å§”å…³äº... [0.89]       â”‚        â”‚
â”‚          â”‚ â€¢ é£Ÿå“å®‰å…¨æ³•å®æ–½æ¡ä¾‹... [0.85]       â”‚        â”‚
â”‚          â”‚ â€¢ å…³äºè¯é£Ÿä¸¤ç”¨ç‰©å“... [0.82]         â”‚        â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [è¾“å…¥æ¡†...]                              [ğŸ”] [ğŸ“] [â¤] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®åŠŸèƒ½**:
1. **å¤šçŸ¥è¯†åº“é€‰æ‹©** - æ”¯æŒåŒæ—¶æ£€ç´¢å¤šä¸ªçŸ¥è¯†åº“
2. **æ£€ç´¢å™¨åˆ‡æ¢** - ä¸‹æ‹‰é€‰æ‹©ä¸åŒæ£€ç´¢ç­–ç•¥
3. **å¼•ç”¨å±•ç¤º** - æŠ˜å å¼å±•ç¤ºæ£€ç´¢åˆ°çš„æ–‡æ¡£ç‰‡æ®µ
4. **Markdown æ¸²æŸ“** - æ”¯æŒä»£ç å—ã€è¡¨æ ¼ã€åˆ—è¡¨
5. **æµå¼è¾“å‡º**ï¼ˆå¯é€‰ï¼‰- éœ€åç«¯æ”¯æŒ SSE

### 4.2 çŸ¥è¯†åº“ç®¡ç†

**å‚è€ƒ**: rag-web-ui çš„ Dashboard å¡ç‰‡å¼è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  çŸ¥è¯†åº“                                    [+ æ–°å»ºçŸ¥è¯†åº“] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“š æ³•è§„æ–‡æ¡£   â”‚  â”‚ ğŸ“š æŠ€æœ¯æ–‡æ¡£   â”‚  â”‚ ğŸ“š äº§å“æ‰‹å†Œ   â”‚  â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚  â”‚
â”‚  â”‚ æ–‡æ¡£: 20     â”‚  â”‚ æ–‡æ¡£: 45     â”‚  â”‚ æ–‡æ¡£: 12     â”‚  â”‚
â”‚  â”‚ æ›´æ–°: 2å¤©å‰  â”‚  â”‚ æ›´æ–°: 1å‘¨å‰  â”‚  â”‚ æ›´æ–°: 3å¤©å‰  â”‚  â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚  â”‚
â”‚  â”‚ [æŸ¥çœ‹] [åˆ é™¤]â”‚  â”‚ [æŸ¥çœ‹] [åˆ é™¤]â”‚  â”‚ [æŸ¥çœ‹] [åˆ é™¤]â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 æ–‡æ¡£ç®¡ç†

**å‚è€ƒ**: rag-web-ui çš„æ–‡æ¡£åˆ—è¡¨ + ä¸Šä¼ è¿›åº¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ³•è§„æ–‡æ¡£ > æ–‡æ¡£åˆ—è¡¨                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ“¤ ä¸Šä¼ æ–‡ä»¶] [ğŸ“ ç²˜è´´æ–‡æœ¬] [ğŸ”„ åˆ·æ–°]                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“„ é£Ÿå“å®‰å…¨æ³•å®æ–½æ¡ä¾‹.md                         â”‚   â”‚
â”‚  â”‚    Chunks: 45  â”‚  åˆ›å»º: 2024-12-01  â”‚  [åˆ é™¤]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“„ è¯é£ŸåŒæºç‰©å“ç®¡ç†è§„å®š.pdf       [å¤„ç†ä¸­... 60%] â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸Šä¼ æ”¯æŒ**:
- **æ–‡ä»¶ç±»å‹**: PDF, DOCX, MD, TXT
- **æ‹–æ‹½ä¸Šä¼ **: æ”¯æŒæ‹–æ‹½åŒºåŸŸ
- **æ‰¹é‡ä¸Šä¼ **: å¤šæ–‡ä»¶åŒæ—¶ä¸Šä¼ 

### 4.4 è®¾ç½®é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è®¾ç½®                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  ğŸ“¡ API é…ç½®                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ API åœ°å€:  [http://localhost:8020          ]    â”‚   â”‚
â”‚  â”‚ API Key:   [kb_sk_************************ ]    â”‚   â”‚
â”‚  â”‚            [æµ‹è¯•è¿æ¥]  âœ… å·²è¿æ¥                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  ğŸ” æ£€ç´¢è®¾ç½®                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ é»˜è®¤æ£€ç´¢å™¨:  [Hybrid â–¼]                         â”‚   â”‚
â”‚  â”‚ é»˜è®¤ Top-K:  [5 â–¼]                              â”‚   â”‚
â”‚  â”‚ æ˜¾ç¤ºå¼•ç”¨æ¥æº: [âœ“]                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  ğŸ¨ ç•Œé¢è®¾ç½®                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ä¸»é¢˜:       [è·Ÿéšç³»ç»Ÿ â–¼]                        â”‚   â”‚
â”‚  â”‚ è¯­è¨€:       [ç®€ä½“ä¸­æ–‡ â–¼]                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 5.1 æŠ€æœ¯æ ˆï¼ˆå·²ç¡®å®šï¼‰

| ç±»åˆ« | æŠ€æœ¯é€‰å‹ |
|------|----------|
| **æ¡†æ¶** | Next.js 14+ (App Router) |
| **è¯­è¨€** | TypeScript |
| **UI ç»„ä»¶** | shadcn/ui |
| **æ ·å¼** | Tailwind CSS |
| **çŠ¶æ€ç®¡ç†** | Zustandï¼ˆå·²å®ç°ï¼‰ |
| **å›¾æ ‡** | Lucide React |
| **HTTP å®¢æˆ·ç«¯** | åŸç”Ÿ fetchï¼ˆå·²å®ç°ï¼‰ |
| **Toast** | Sonnerï¼ˆå·²é›†æˆï¼‰ |

### 5.2 é¡¹ç›®ç»“æ„

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ layout.tsx          # æ ¹å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ page.tsx            # é¦–é¡µï¼ˆé‡å®šå‘åˆ° /chatï¼‰
â”‚   â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx        # æ–°å¯¹è¯
â”‚   â”‚   â”‚   â””â”€â”€ [id]/page.tsx   # å¯¹è¯è¯¦æƒ…
â”‚   â”‚   â”œâ”€â”€ knowledge/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx        # çŸ¥è¯†åº“åˆ—è¡¨
â”‚   â”‚   â”‚   â””â”€â”€ [id]/page.tsx   # çŸ¥è¯†åº“è¯¦æƒ…/æ–‡æ¡£ç®¡ç†
â”‚   â”‚   â””â”€â”€ settings/
â”‚   â”‚       â”œâ”€â”€ page.tsx        # è®¾ç½®ä¸»é¡µ
â”‚   â”‚       â””â”€â”€ api-keys/page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/                 # shadcn/ui ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Footer.tsx
â”‚   â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatWindow.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageBubble.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ SourcesPanel.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ChatInput.tsx
â”‚   â”‚   â”œâ”€â”€ knowledge/
â”‚   â”‚   â”‚   â”œâ”€â”€ KBCard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ KBCreateDialog.tsx
â”‚   â”‚   â”‚   â””â”€â”€ DocumentList.tsx
â”‚   â”‚   â””â”€â”€ shared/
â”‚   â”‚       â”œâ”€â”€ FileUploader.tsx
â”‚   â”‚       â”œâ”€â”€ RetrieverSelect.tsx
â”‚   â”‚       â””â”€â”€ KBMultiSelect.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ api.ts              # API å®¢æˆ·ç«¯ï¼ˆå·²å®ç°ï¼‰
â”‚   â”‚   â”œâ”€â”€ store.ts            # Zustand storeï¼ˆå·²å®ç°ï¼‰
â”‚   â”‚   â””â”€â”€ utils.ts
â”‚   â”‚
â”‚   â””â”€â”€ types/
â”‚       â””â”€â”€ index.ts            # ç±»å‹å®šä¹‰
â”‚
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ uiå¼€å‘.md               # æœ¬æ–‡æ¡£
â””â”€â”€ package.json
```

### 5.3 çŠ¶æ€ç®¡ç†ï¼ˆæ‰©å±• store.tsï¼‰

```typescript
// èŠå¤©å†å² store
interface ChatStore {
  conversations: Conversation[];
  currentConversationId: string | null;
  
  // Actions
  createConversation: (kbIds: string[]) => string;
  addMessage: (convId: string, message: Message) => void;
  deleteConversation: (id: string) => void;
}

// è®¾ç½® store
interface SettingsStore {
  defaultRetriever: string;
  defaultTopK: number;
  showSources: boolean;
  theme: 'light' | 'dark' | 'system';
}
```

---

## å…­ã€å¼€å‘è®¡åˆ’

### Phase 1: åŸºç¡€å¸ƒå±€ï¼ˆ1-2 å¤©ï¼‰ âœ…

- [x] å®ç° `Header` + `Sidebar` + `Footer` å¸ƒå±€ç»„ä»¶
- [x] å®ç°å“åº”å¼è®¾è®¡ï¼ˆç§»åŠ¨ç«¯ä¾§è¾¹æ æŠ˜å ï¼‰
- [x] æ·»åŠ è·¯ç”±å¯¼èˆª
- [x] å®ç°æ·±è‰²/æµ…è‰²ä¸»é¢˜åˆ‡æ¢ï¼ˆnext-themes + ThemeProviderï¼‰

### Phase 2: å¯¹è¯åŠŸèƒ½ï¼ˆ2-3 å¤©ï¼‰ âœ…

- [x] å®ç° `ChatWindow` æ¶ˆæ¯åˆ—è¡¨
- [x] å®ç° `MessageBubble` æ¶ˆæ¯æ°”æ³¡ï¼ˆç”¨æˆ·/AI åŒºåˆ†ï¼‰
- [x] å®ç° `ChatInput` è¾“å…¥æ¡† + å‘é€æŒ‰é’®
- [x] å®ç°æ£€ç´¢å™¨/Top-K é…ç½®
- [x] å®ç° SSE æµå¼è¾“å‡ºå®¢æˆ·ç«¯
- [x] å®ç° `SourcesPanel` å¼•ç”¨æ¥æºæŠ˜å é¢æ¿ï¼ˆCollapsible + ç›¸å…³åº¦é¢œè‰²æ ‡è®°ï¼‰
- [x] å®ç° Markdown æ¸²æŸ“ï¼ˆreact-markdown + remark-gfm + rehype-highlightï¼‰
- [x] å®ç°èŠå¤©å†å²æŒä¹…åŒ–ï¼ˆSidebar å†å²åˆ—è¡¨ + Store å¯¹è¯ç®¡ç†ï¼‰

### Phase 3: çŸ¥è¯†åº“ç®¡ç†ï¼ˆ1-2 å¤©ï¼‰ âœ…

- [x] å®ç° `KBCard` çŸ¥è¯†åº“å¡ç‰‡ç»„ä»¶
- [x] å®ç° `KBCreateDialog` åˆ›å»ºå¯¹è¯æ¡†
- [x] å®ç°çŸ¥è¯†åº“åˆ—è¡¨é¡µ
- [x] å®ç°åˆ é™¤ç¡®è®¤

### Phase 4: æ–‡æ¡£ç®¡ç†ï¼ˆ2 å¤©ï¼‰ âœ…

- [x] å®ç° `DocumentList` æ–‡æ¡£åˆ—è¡¨ï¼ˆTable ç»„ä»¶ï¼‰
- [x] å®ç° `FileUploader` æ–‡ä»¶ä¸Šä¼ ï¼ˆreact-dropzone æ‹–æ‹½ + ç‚¹å‡»ï¼‰
- [x] å®ç°æ–‡æœ¬ç²˜è´´ä¸Šä¼ ï¼ˆDialog å¼¹çª—ï¼‰
- [x] å®ç°ä¸Šä¼ è¿›åº¦æ˜¾ç¤º
- [x] å®ç°æ–‡æ¡£åˆ é™¤
- [x] çŸ¥è¯†åº“è¯¦æƒ…é¡µ `/knowledge-bases/[id]`
- [x] çŸ¥è¯†åº“å¡ç‰‡å¼åˆ—è¡¨ä¼˜åŒ–

### Phase 5: è®¾ç½®ä¸ä¼˜åŒ–ï¼ˆ1 å¤©ï¼‰ âœ…

- [x] å®ç°è®¾ç½®é¡µé¢ï¼ˆAPI é…ç½®ï¼‰
- [x] å®ç° API Key ç®¡ç†ï¼ˆadmin è§’è‰²ï¼‰
- [x] é”™è¯¯å¤„ç†ä¼˜åŒ–ï¼ˆErrorBoundary + EmptyState + LoadingStateï¼‰
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆè™šæ‹Ÿåˆ—è¡¨ã€æ‡’åŠ è½½ï¼‰- å¯é€‰

---

## ä¸ƒã€å…³é”®å®ç°å‚è€ƒ

### 7.1 å¼•ç”¨æ¥æºå±•ç¤ºï¼ˆå‚è€ƒ rag-web-uiï¼‰

```tsx
// components/chat/SourcesPanel.tsx
import { Collapsible, CollapsibleContent, CollapsibleTrigger } from "@/components/ui/collapsible";
import { FileText, ChevronDown } from "lucide-react";

interface Source {
  text: string;
  score: number;
  document_title: string;
}

export function SourcesPanel({ sources }: { sources: Source[] }) {
  if (!sources?.length) return null;
  
  return (
    <Collapsible className="mt-2 border rounded-lg">
      <CollapsibleTrigger className="flex items-center gap-2 p-2 w-full hover:bg-muted">
        <FileText className="h-4 w-4" />
        <span className="text-sm">å¼•ç”¨æ¥æº ({sources.length})</span>
        <ChevronDown className="h-4 w-4 ml-auto" />
      </CollapsibleTrigger>
      <CollapsibleContent>
        <div className="p-2 space-y-2">
          {sources.map((src, i) => (
            <div key={i} className="text-sm p-2 bg-muted rounded">
              <div className="font-medium">{src.document_title}</div>
              <div className="text-muted-foreground text-xs mt-1">
                {src.text.slice(0, 200)}...
              </div>
              <div className="text-xs text-blue-500 mt-1">
                ç›¸å…³åº¦: {(src.score * 100).toFixed(1)}%
              </div>
            </div>
          ))}
        </div>
      </CollapsibleContent>
    </Collapsible>
  );
}
```

### 7.2 æ–‡ä»¶ä¸Šä¼ ç»„ä»¶ï¼ˆå‚è€ƒ Open WebUIï¼‰

```tsx
// components/shared/FileUploader.tsx
import { useCallback } from "react";
import { useDropzone } from "react-dropzone";
import { Upload, File } from "lucide-react";

export function FileUploader({ onUpload }: { onUpload: (files: File[]) => void }) {
  const onDrop = useCallback((acceptedFiles: File[]) => {
    onUpload(acceptedFiles);
  }, [onUpload]);

  const { getRootProps, getInputProps, isDragActive } = useDropzone({
    onDrop,
    accept: {
      'application/pdf': ['.pdf'],
      'text/markdown': ['.md'],
      'text/plain': ['.txt'],
      'application/vnd.openxmlformats-officedocument.wordprocessingml.document': ['.docx'],
    },
  });

  return (
    <div
      {...getRootProps()}
      className={`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer
        ${isDragActive ? 'border-primary bg-primary/5' : 'border-muted-foreground/25'}`}
    >
      <input {...getInputProps()} />
      <Upload className="h-10 w-10 mx-auto mb-4 text-muted-foreground" />
      <p className="text-sm text-muted-foreground">
        {isDragActive ? 'é‡Šæ”¾ä»¥ä¸Šä¼ ' : 'æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©'}
      </p>
      <p className="text-xs text-muted-foreground mt-2">
        æ”¯æŒ PDF, DOCX, MD, TXT
      </p>
    </div>
  );
}
```

### 7.3 å¤šçŸ¥è¯†åº“é€‰æ‹©å™¨

```tsx
// components/shared/KBMultiSelect.tsx
import { Badge } from "@/components/ui/badge";
import { Command, CommandGroup, CommandItem } from "@/components/ui/command";
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover";
import { Button } from "@/components/ui/button";
import { Check, ChevronsUpDown, X } from "lucide-react";

export function KBMultiSelect({
  knowledgeBases,
  selected,
  onSelect,
}: {
  knowledgeBases: { id: string; name: string }[];
  selected: string[];
  onSelect: (ids: string[]) => void;
}) {
  const toggle = (id: string) => {
    onSelect(
      selected.includes(id)
        ? selected.filter((s) => s !== id)
        : [...selected, id]
    );
  };

  return (
    <Popover>
      <PopoverTrigger asChild>
        <Button variant="outline" className="justify-between min-w-[200px]">
          {selected.length === 0 ? (
            "é€‰æ‹©çŸ¥è¯†åº“..."
          ) : (
            <div className="flex gap-1 flex-wrap">
              {selected.map((id) => (
                <Badge key={id} variant="secondary" className="text-xs">
                  {knowledgeBases.find((kb) => kb.id === id)?.name}
                </Badge>
              ))}
            </div>
          )}
          <ChevronsUpDown className="h-4 w-4 opacity-50" />
        </Button>
      </PopoverTrigger>
      <PopoverContent className="p-0">
        <Command>
          <CommandGroup>
            {knowledgeBases.map((kb) => (
              <CommandItem key={kb.id} onSelect={() => toggle(kb.id)}>
                <Check
                  className={`mr-2 h-4 w-4 ${
                    selected.includes(kb.id) ? "opacity-100" : "opacity-0"
                  }`}
                />
                {kb.name}
              </CommandItem>
            ))}
          </CommandGroup>
        </Command>
      </PopoverContent>
    </Popover>
  );
}
```

---

## å…«ã€ä¸å‚è€ƒé¡¹ç›®çš„å·®å¼‚

| åŠŸèƒ½ | rag-web-ui | Open WebUI | Self-RAG UI |
|------|------------|------------|-------------|
| **å¤šæ£€ç´¢å™¨** | âŒ å•ä¸€æ£€ç´¢ | âŒ å•ä¸€æ£€ç´¢ | âœ… 6+ æ£€ç´¢å™¨å¯é€‰ |
| **æ£€ç´¢å™¨å¯¹æ¯”** | âŒ | âŒ | âœ… å¯å®ç° |
| **å¼•ç”¨æ¥æº** | âœ… | âœ… | âœ… |
| **å¤šçŸ¥è¯†åº“** | âŒ å•é€‰ | âœ… | âœ… å¤šé€‰ |
| **æµå¼è¾“å‡º** | âœ… | âœ… | â³ åç«¯å¾…æ”¯æŒ |
| **å¤šæ¨¡å‹å¯¹æ¯”** | âŒ | âœ… | âŒ å•æ¨¡å‹ |
| **ç§Ÿæˆ·ç®¡ç†** | âŒ | âŒ | âœ… Admin API |
| **è¯­éŸ³è¾“å…¥** | âŒ | âœ… | âŒ æš‚ä¸éœ€è¦ |

---

## ä¹ã€æ ¸å¿ƒéœ€æ±‚ç¡®è®¤ âœ…

| éœ€æ±‚ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| **SSE æµå¼è¾“å‡º** | âœ… éœ€è¦ | åç«¯éœ€æ–°å¢ streaming æ¥å£ |
| **æ£€ç´¢å™¨å¯¹æ¯”** | âœ… éœ€è¦ | åŒä¸€é—®é¢˜å¤šæ£€ç´¢å™¨ç»“æœå¯¹æ¯” |
| **RAG å›ç­”å¯¹æ¯”** | âœ… éœ€è¦ | ä¸åŒæ£€ç´¢å™¨çš„ç”Ÿæˆå›ç­”å¯¹æ¯” |
| **èŠå¤©å†å²æŒä¹…åŒ–** | âœ… éœ€è¦ | æœåŠ¡ç«¯å­˜å‚¨ï¼Œéœ€æ–°å¢ API |

---

## åã€æ–°å¢åŠŸèƒ½è¯¦ç»†è®¾è®¡

### 10.1 SSE æµå¼è¾“å‡º

**åç«¯æ”¹åŠ¨** (`app/api/routes/rag.py`):
```python
from fastapi.responses import StreamingResponse
from sse_starlette.sse import EventSourceResponse

@router.post("/v1/rag/stream")
async def rag_stream(payload: RAGRequest, ...):
    async def generate():
        # 1. å…ˆè¿”å›æ£€ç´¢ç»“æœ
        yield {"event": "sources", "data": json.dumps(sources)}
        
        # 2. æµå¼è¿”å›ç”Ÿæˆå†…å®¹
        async for chunk in llm.stream_chat(prompt):
            yield {"event": "content", "data": chunk}
        
        # 3. ç»“æŸæ ‡è®°
        yield {"event": "done", "data": ""}
    
    return EventSourceResponse(generate())
```

**å‰ç«¯å®ç°**:
```typescript
// lib/api.ts
async ragStream(
  query: string,
  kbIds: string[],
  retriever: string,
  onSources: (sources: Source[]) => void,
  onChunk: (text: string) => void,
  onDone: () => void
) {
  const response = await fetch(`${this.baseUrl}/v1/rag/stream`, {
    method: "POST",
    headers: { Authorization: `Bearer ${this.apiKey}`, "Content-Type": "application/json" },
    body: JSON.stringify({ query, knowledge_base_ids: kbIds, retriever_override: { name: retriever } }),
  });

  const reader = response.body?.getReader();
  const decoder = new TextDecoder();
  
  while (true) {
    const { done, value } = await reader!.read();
    if (done) break;
    
    const lines = decoder.decode(value).split("\n");
    for (const line of lines) {
      if (line.startsWith("event: sources")) {
        // è§£ææ¥æº
      } else if (line.startsWith("data: ")) {
        onChunk(line.slice(6));
      }
    }
  }
  onDone();
}
```

### 10.2 æ£€ç´¢å™¨å¯¹æ¯”åŠŸèƒ½

**UI è®¾è®¡**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” æ£€ç´¢å™¨å¯¹æ¯”æ¨¡å¼                            [å¼€å¯å¯¹æ¯” âœ“]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€‰æ‹©å¯¹æ¯”æ£€ç´¢å™¨:                                                â”‚
â”‚  [âœ“] Dense  [âœ“] BM25  [âœ“] Hybrid  [ ] HyDE  [ ] Fusion         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é—®é¢˜: è¯é£ŸåŒæºç‰©å“çš„ç®¡ç†è§„å®šæ˜¯ä»€ä¹ˆï¼Ÿ                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Dense (0.3s)  â”‚   BM25 (0.1s)   â”‚  Hybrid (0.4s)  â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚ 1. æ–‡æ¡£A [0.89] â”‚ 1. æ–‡æ¡£B [12.3] â”‚ 1. æ–‡æ¡£A [0.92] â”‚       â”‚
â”‚  â”‚ 2. æ–‡æ¡£C [0.85] â”‚ 2. æ–‡æ¡£A [11.8] â”‚ 2. æ–‡æ¡£B [0.88] â”‚       â”‚
â”‚  â”‚ 3. æ–‡æ¡£B [0.82] â”‚ 3. æ–‡æ¡£D [10.5] â”‚ 3. æ–‡æ¡£C [0.85] â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API è°ƒç”¨**ï¼ˆå¹¶è¡Œè¯·æ±‚ï¼‰:
```typescript
// å¹¶è¡Œè°ƒç”¨å¤šä¸ªæ£€ç´¢å™¨
async compareRetrievers(query: string, kbIds: string[], retrievers: string[]) {
  const results = await Promise.all(
    retrievers.map(async (retriever) => {
      const start = Date.now();
      const result = await this.retrieve(query, kbIds, 5, retriever);
      return {
        retriever,
        results: result.results,
        latency: Date.now() - start,
      };
    })
  );
  return results;
}
```

### 10.3 RAG å›ç­”å¯¹æ¯”åŠŸèƒ½

**UI è®¾è®¡**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¬ RAG å›ç­”å¯¹æ¯”                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é—®é¢˜: è¯é£ŸåŒæºç‰©å“æœ‰å“ªäº›ï¼Ÿ                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚      Hybrid (1.2s)        â”‚       HyDE (2.5s)         â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚ æ ¹æ®ã€ŠæŒ‰ç…§ä¼ ç»Ÿæ—¢æ˜¯é£Ÿå“    â”‚ è¯é£ŸåŒæºç‰©å“æ˜¯æŒ‡æ—¢å¯ä»¥   â”‚     â”‚
â”‚  â”‚ åˆæ˜¯ä¸­è¯æç‰©è´¨ç›®å½•ã€‹...   â”‚ ä½œä¸ºé£Ÿå“é£Ÿç”¨ï¼Œåˆå¯ä»¥...   â”‚     â”‚
â”‚  â”‚                           â”‚                           â”‚     â”‚
â”‚  â”‚ ğŸ“„ å¼•ç”¨ (5)               â”‚ ğŸ“„ å¼•ç”¨ (5)               â”‚     â”‚
â”‚  â”‚ â€¢ æ–‡æ¡£A [0.92]            â”‚ â€¢ æ–‡æ¡£B [0.95]            â”‚     â”‚
â”‚  â”‚ â€¢ æ–‡æ¡£B [0.88]            â”‚ â€¢ æ–‡æ¡£A [0.91]            â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â”‚  [ğŸ‘ Hybrid æ›´å¥½] [ğŸ‘ HyDE æ›´å¥½] [ğŸ¤ å·®ä¸å¤š]                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç»„ä»¶å®ç°**:
```tsx
// components/chat/ComparePanel.tsx
interface CompareResult {
  retriever: string;
  answer: string;
  sources: Source[];
  latency: number;
}

export function ComparePanel({ 
  query, 
  results 
}: { 
  query: string; 
  results: CompareResult[] 
}) {
  return (
    <div className="grid grid-cols-2 gap-4">
      {results.map((r) => (
        <Card key={r.retriever}>
          <CardHeader>
            <CardTitle className="flex justify-between">
              <span>{r.retriever}</span>
              <Badge variant="outline">{r.latency}ms</Badge>
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="prose prose-sm">{r.answer}</div>
            <SourcesPanel sources={r.sources} />
          </CardContent>
        </Card>
      ))}
    </div>
  );
}
```

### 10.4 èŠå¤©å†å²æœåŠ¡ç«¯æŒä¹…åŒ–

**åç«¯æ–°å¢ API**:

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| `POST` | `/v1/conversations` | åˆ›å»ºå¯¹è¯ |
| `GET` | `/v1/conversations` | å¯¹è¯åˆ—è¡¨ |
| `GET` | `/v1/conversations/{id}` | å¯¹è¯è¯¦æƒ…ï¼ˆå«æ¶ˆæ¯ï¼‰ |
| `DELETE` | `/v1/conversations/{id}` | åˆ é™¤å¯¹è¯ |
| `POST` | `/v1/conversations/{id}/messages` | æ·»åŠ æ¶ˆæ¯ |

**æ•°æ®æ¨¡å‹** (`app/models/conversation.py`):
```python
class Conversation(Base):
    __tablename__ = "conversations"
    
    id = Column(UUID, primary_key=True, default=uuid4)
    tenant_id = Column(UUID, ForeignKey("tenants.id"), nullable=False)
    title = Column(String(255))  # è‡ªåŠ¨ä»é¦–æ¡æ¶ˆæ¯ç”Ÿæˆ
    knowledge_base_ids = Column(ARRAY(UUID))  # å…³è”çš„çŸ¥è¯†åº“
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, onupdate=datetime.utcnow)
    
    messages = relationship("Message", back_populates="conversation")

class Message(Base):
    __tablename__ = "messages"
    
    id = Column(UUID, primary_key=True, default=uuid4)
    conversation_id = Column(UUID, ForeignKey("conversations.id"), nullable=False)
    role = Column(String(20))  # user / assistant
    content = Column(Text)
    retriever = Column(String(50))  # ä½¿ç”¨çš„æ£€ç´¢å™¨
    sources = Column(JSONB)  # å¼•ç”¨æ¥æº
    created_at = Column(DateTime, default=datetime.utcnow)
    
    conversation = relationship("Conversation", back_populates="messages")
```

**å‰ç«¯ API å°è£…**:
```typescript
// lib/api.ts
// å¯¹è¯ç®¡ç†
async listConversations(): Promise<{ items: Conversation[]; total: number }> {
  return this.request("GET", "/v1/conversations");
}

async createConversation(kbIds: string[], title?: string): Promise<Conversation> {
  return this.request("POST", "/v1/conversations", { knowledge_base_ids: kbIds, title });
}

async getConversation(id: string): Promise<ConversationDetail> {
  return this.request("GET", `/v1/conversations/${id}`);
}

async deleteConversation(id: string): Promise<void> {
  return this.request("DELETE", `/v1/conversations/${id}`);
}

async addMessage(convId: string, message: Omit<Message, "id">): Promise<Message> {
  return this.request("POST", `/v1/conversations/${convId}/messages`, message);
}
```

---

## åä¸€ã€åç«¯æ”¹åŠ¨æ¸…å•

### éœ€è¦æ–°å¢çš„åç«¯åŠŸèƒ½

| ä¼˜å…ˆçº§ | æ¨¡å— | æ”¹åŠ¨ |
|--------|------|------|
| **P0** | SSE æµå¼ | æ–°å¢ `/v1/rag/stream` ç«¯ç‚¹ |
| **P0** | å¯¹è¯æŒä¹…åŒ– | æ–°å¢ Conversation/Message æ¨¡å‹å’Œ API |
| **P1** | LLM æµå¼ | `infra/llm.py` æ”¯æŒ `stream_chat()` |
| **P2** | ä¾èµ– | æ·»åŠ  `sse-starlette` åŒ… |

### æ•°æ®åº“è¿ç§»

```bash
# åˆ›å»ºè¿ç§»è„šæœ¬
uv run alembic revision --autogenerate -m "add conversation and message tables"

# æ‰§è¡Œè¿ç§»
uv run alembic upgrade head
```

---

## åäºŒã€æ›´æ–°åçš„å¼€å‘è®¡åˆ’

### Phase 1: åç«¯æ‰©å±• âœ… å·²å®Œæˆ

- [x] æ–°å¢ `Conversation` / `Message` æ¨¡å‹ (`app/models/conversation.py`)
- [x] å®ç°å¯¹è¯ CRUD API (`app/api/routes/conversations.py`)
- [x] å®ç° SSE æµå¼ RAG ç«¯ç‚¹ (`app/api/routes/rag_stream.py`)
- [x] LLM æµå¼è¾“å‡ºæ”¯æŒ (`app/infra/llm.py` - `chat_completion_stream`)
- [x] æ•°æ®åº“è¿ç§»è„šæœ¬ (`alembic/versions/f8c3e2b1a5d4_*.py`)

**å·²å®ç°çš„ API ç«¯ç‚¹ï¼š**

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | `/v1/conversations` | åˆ›å»ºå¯¹è¯ |
| GET | `/v1/conversations` | å¯¹è¯åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰ |
| GET | `/v1/conversations/{id}` | å¯¹è¯è¯¦æƒ…ï¼ˆå«æ¶ˆæ¯ï¼‰ |
| PATCH | `/v1/conversations/{id}` | æ›´æ–°å¯¹è¯ |
| DELETE | `/v1/conversations/{id}` | åˆ é™¤å¯¹è¯ |
| POST | `/v1/conversations/{id}/messages` | æ·»åŠ æ¶ˆæ¯ |
| POST | `/v1/rag/stream` | SSE æµå¼ RAG |

### Phase 2: åŸºç¡€å¸ƒå±€ï¼ˆå½“å‰ï¼‰

- [ ] åˆå§‹åŒ– Next.js é¡¹ç›®
- [ ] Header + Sidebar + Footer
- [ ] å“åº”å¼è®¾è®¡
- [ ] è·¯ç”±å¯¼èˆª

### Phase 3: å¯¹è¯åŠŸèƒ½ï¼ˆ2-3 å¤©ï¼‰

- [ ] å¯¹è¯åˆ—è¡¨ï¼ˆä¾§è¾¹æ ï¼‰
- [ ] æ¶ˆæ¯æµå¼æ¸²æŸ“
- [ ] å¼•ç”¨æ¥æºå±•ç¤º
- [ ] Markdown æ¸²æŸ“

### Phase 4: å¯¹æ¯”åŠŸèƒ½ï¼ˆ2 å¤©ï¼‰

- [ ] æ£€ç´¢å™¨å¯¹æ¯”è§†å›¾
- [ ] RAG å›ç­”å¯¹æ¯”è§†å›¾
- [ ] å¹¶è¡Œè¯·æ±‚ä¼˜åŒ–

### Phase 5: çŸ¥è¯†åº“/æ–‡æ¡£ç®¡ç†ï¼ˆ2 å¤©ï¼‰

- [ ] çŸ¥è¯†åº“å¡ç‰‡åˆ—è¡¨
- [ ] æ–‡æ¡£ä¸Šä¼ ï¼ˆæ‹–æ‹½ï¼‰
- [ ] æ–‡æ¡£åˆ—è¡¨

### Phase 6: è®¾ç½®ä¸ä¼˜åŒ–ï¼ˆ1 å¤©ï¼‰

- [ ] API é…ç½®é¡µ
- [ ] ä¸»é¢˜åˆ‡æ¢
- [ ] é”™è¯¯å¤„ç†

**æ€»è®¡: çº¦ 10-12 å¤©**

---

## åä¸‰ã€ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. ~~**å…ˆå®ç°åç«¯** - å¯¹è¯æŒä¹…åŒ– + SSE æµå¼æ¥å£~~ âœ…
2. ~~**å‰ç«¯åŸºç¡€å¼€å‘** - åŸºäºæ–° API æ„å»º UI~~ âœ…
3. **æ­£åœ¨è¿›è¡Œï¼šUI/UX ä¼˜åŒ–** - åŸºäº Ant Design è®¾è®¡è§„èŒƒä¼˜åŒ–ç•Œé¢
4. **ä¸‹ä¸€æ­¥ï¼šå¯¹æ¯”åŠŸèƒ½** - æ£€ç´¢å™¨/RAG å¯¹æ¯”

---

## åå››ã€UI/UX ä¼˜åŒ–è®°å½•

### 14.1 å·²å®Œæˆä¼˜åŒ–

| æ—¥æœŸ | ç»„ä»¶ | ä¼˜åŒ–å†…å®¹ |
|------|------|----------|
| 2025-01 | Sidebar | ä¾§è¾¹æ é«˜åº¦æ’‘æ»¡å…¨å±ï¼›å¯¹è¯å†å²åˆ—è¡¨æ ·å¼æ”¹è¿›ï¼›å¯¼èˆªé¡¹è§†è§‰ä¼˜åŒ– |
| 2025-01 | ChatView | é¡¶éƒ¨å·¥å…·æ æ ·å¼ä¼˜åŒ–ï¼›ç©ºçŠ¶æ€å±•ç¤ºæ”¹è¿›ï¼›è¾“å…¥åŒºæ‚¬æµ®å±…ä¸­åœ†è§’è®¾è®¡ |
| 2025-01 | MessageBubble | æ°”æ³¡åœ†è§’å’ŒèƒŒæ™¯è‰²ä¼˜åŒ–ï¼›Markdown æ¸²æŸ“æ ·å¼æ”¹è¿›ï¼›å¤´åƒå¤§å°å’Œé—´è·è°ƒæ•´ |
| 2025-01 | AppShell | ä¿®å¤æ¡Œé¢ç«¯ Sidebar å®¹å™¨é«˜åº¦é—®é¢˜ |
| 2025-12 | SourcesPanel | ç›¸å…³åº¦è¿›åº¦æ¡å¯è§†åŒ–ï¼›å±•å¼€/æ”¶èµ·åŠ¨ç”»ï¼›é¢œè‰²åˆ†çº§ï¼ˆç»¿/è“/é»„ï¼‰ï¼›å¡ç‰‡å¼å¸ƒå±€ |
| 2025-12 | ChatView ç©ºçŠ¶æ€ | åŠŸèƒ½ä»‹ç»å¡ç‰‡ç»„ï¼›åŠ¨ç”»å›¾æ ‡ï¼›çŸ¥è¯†åº“é€‰æ‹©å¼•å¯¼æç¤º |
| 2025-12 | ChatView å¸ƒå±€ | é€‚é…çª—å£é«˜åº¦ï¼›è¾“å…¥æ¡†å§‹ç»ˆå¯è§ï¼›ç©ºçŠ¶æ€å±…ä¸­æ˜¾ç¤º |
| 2025-12 | è‡ªåŠ¨é‡è¿ | é¡µé¢åˆ·æ–°åè‡ªåŠ¨æ¢å¤ API è¿æ¥çŠ¶æ€ï¼›è‡ªåŠ¨åŠ è½½çŸ¥è¯†åº“å’Œå¯¹è¯åˆ—è¡¨ |
| 2025-12 | MessageBubble | æ·»åŠ å¤åˆ¶æŒ‰é’®ï¼ˆæ‚¬åœæ˜¾ç¤ºï¼‰ï¼›å¤åˆ¶æˆåŠŸåé¦ˆåŠ¨ç”» |
| 2025-12 | è®¾ç½®é¡µ | API åœ°å€å¤åˆ¶æŒ‰é’®ï¼›API Key å¯è§†åŒ–åˆ‡æ¢æŒ‰é’®ï¼›API Key å¤åˆ¶æŒ‰é’® |

### 14.2 å¾…ä¼˜åŒ–é¡¹ç›®

| ä¼˜å…ˆçº§ | ç»„ä»¶ | ä¼˜åŒ–å†…å®¹ |
|--------|------|----------|
| P1 | è¾“å…¥åŒº | è‡ªåŠ¨é«˜åº¦è°ƒæ•´ï¼›å¿«æ·é”®æ”¯æŒï¼›é™„ä»¶é¢„è§ˆ |
| P2 | çŸ¥è¯†åº“å¡ç‰‡ | å¡ç‰‡æ‚¬åœæ•ˆæœï¼›è¿›åº¦æŒ‡ç¤ºå™¨ï¼›ç©ºçŠ¶æ€æ’ç”» |
| P3 | å…¨å±€ | éª¨æ¶å±åŠ è½½ï¼›é”™è¯¯è¾¹ç•Œä¼˜åŒ–ï¼›Toast æ ·å¼ç»Ÿä¸€ |

### 14.3 è®¾è®¡è§„èŒƒéµå¾ªæ£€æŸ¥æ¸…å•

- [x] é—´è·ä½¿ç”¨ 8px å€æ•°
- [x] åœ†è§’ä¿æŒä¸€è‡´ï¼ˆ4px/8px/16pxï¼‰
- [x] è‰²å½©ä½¿ç”¨ CSS å˜é‡
- [x] å­—ä½“å±‚çº§æ¸…æ™°
- [x] åŠ¨æ•ˆæ—¶é•¿æ ‡å‡†åŒ–ï¼ˆtransition-all duration-200/300ï¼‰
- [x] å…¨éƒ¨æŒ‰é’®æ·»åŠ æ‚¬åœ/æ¿€æ´»æ€
- [x] è¡¨å•è¾“å…¥æ·»åŠ ç„¦ç‚¹æ€
- [x] ç©ºçŠ¶æ€æ·»åŠ å¼•å¯¼æ–‡æ¡ˆï¼ˆChatView åŠŸèƒ½å¡ç‰‡ï¼‰
- [ ] éª¨æ¶å±åŠ è½½çŠ¶æ€
- [ ] é”™è¯¯è¾¹ç•Œç»„ä»¶

---

## åäº”ã€å¾…å¼€å‘é¡¹ (TODO)

### 15.1 Playground åç«¯æŒä¹…åŒ–

**å½“å‰çŠ¶æ€**ï¼šPlaygroundï¼ˆRAG Pipeline å¯¹æ¯”å®éªŒï¼‰æ•°æ®å­˜å‚¨åœ¨æµè§ˆå™¨ localStorageï¼Œä»…é€‚åˆæœ¬åœ°æ¼”ç¤ºã€‚

**é—®é¢˜**ï¼š
- æ•°æ®ä»…å­˜åœ¨æœ¬åœ°æµè§ˆå™¨
- æ¢è®¾å¤‡/æ¸…ç¼“å­˜æ•°æ®ä¸¢å¤±
- æ— æ³•å¤šç”¨æˆ·å…±äº«

**å¾…å¼€å‘å†…å®¹**ï¼š

1. **åç«¯ API** (`app/api/routes/playground.py`)
   ```
   POST   /v1/playgrounds              - åˆ›å»º Playground
   GET    /v1/playgrounds              - åˆ—å‡ºå½“å‰ç§Ÿæˆ·çš„ Playground
   GET    /v1/playgrounds/{id}         - è·å–è¯¦æƒ…ï¼ˆå«é…ç½®åˆ—è¡¨ï¼‰
   PUT    /v1/playgrounds/{id}         - æ›´æ–°åç§°/æè¿°
   DELETE /v1/playgrounds/{id}         - åˆ é™¤
   POST   /v1/playgrounds/{id}/configs - æ·»åŠ é…ç½®
   PUT    /v1/playgrounds/{id}/configs/{config_id}    - æ›´æ–°é…ç½®
   DELETE /v1/playgrounds/{id}/configs/{config_id}    - åˆ é™¤é…ç½®
   ```

2. **æ•°æ®åº“æ¨¡å‹** (`app/models/playground.py`)
   - `Playground` è¡¨ï¼šid, tenant_id, name, description, cover_id, created_at, updated_at
   - `PlaygroundConfig` è¡¨ï¼šid, playground_id, name, chunker, chunk_size, chunk_overlap, retriever, top_k, embedding_provider, embedding_model, rerank_provider, vector_db, index_type

3. **å‰ç«¯æ”¹é€ **
   - `src/app/(main)/compare/page.tsx` - åˆ—è¡¨é¡µæ”¹ä¸ºè°ƒç”¨ `client.listPlaygrounds()`
   - `src/app/(main)/compare/[id]/page.tsx` - è¯¦æƒ…é¡µæ”¹ä¸ºè°ƒç”¨åç«¯ API
   - `src/lib/api.ts` - æ·»åŠ  Playground ç›¸å…³æ–¹æ³•
   - ç§»é™¤ localStorage ç›¸å…³ä»£ç 

4. **SDK æ‰©å±•** (`sdk/kb_service_sdk/`)
   - æ·»åŠ  `list_playgrounds()`, `create_playground()`, `get_playground()` ç­‰æ–¹æ³•

---

*æ–‡æ¡£ç‰ˆæœ¬: v1.5 | æ›´æ–°æ—¶é—´: 2025-12-08*
*è®¾è®¡è§„èŒƒå‚è€ƒ: [Ant Design 5.x](https://ant.design/docs/spec/introduce-cn)*
