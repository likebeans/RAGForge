# ç”Ÿäº§å®¹å™¨å¯åŠ¨æµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¥æœŸ**ï¼š2026-01-15  
**æµ‹è¯•äººå‘˜**ï¼šAI åŠ©æ‰‹  
**æµ‹è¯•ç¯å¢ƒ**ï¼šDocker Composeï¼ˆä¸»é…ç½®ï¼‰

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

ä½¿ç”¨ Docker Compose ä¸»é…ç½®å¯åŠ¨ç”Ÿäº§å®¹å™¨ï¼ŒéªŒè¯æ‰€æœ‰æœåŠ¡çš„è¿è¡ŒçŠ¶æ€å’ŒåŸºæœ¬åŠŸèƒ½ã€‚

## ğŸš€ å¯åŠ¨é…ç½®

### ä½¿ç”¨çš„é…ç½®æ–‡ä»¶
- **é…ç½®æ–‡ä»¶**ï¼š`docker-compose.yml`ï¼ˆä¸»é…ç½®ï¼‰
- **æŠ€æœ¯æ ˆ**ï¼šPostgreSQL 15 + Redis 7 + API + Frontend
- **BM25 å­˜å‚¨**ï¼šå†…å­˜æ¨¡å¼ï¼ˆé€‚åˆå¼€å‘å’Œå°è§„æ¨¡ä½¿ç”¨ï¼‰

### å¯åŠ¨å‘½ä»¤
```bash
docker compose up -d --pull never
```

**è¯´æ˜**ï¼šç”±äºç½‘ç»œæ— æ³•è®¿é—® Docker Hubï¼Œä½¿ç”¨ `--pull never` å¼ºåˆ¶ä½¿ç”¨æœ¬åœ°é•œåƒã€‚

## âœ… æµ‹è¯•ç»“æœ

### 1. å®¹å™¨çŠ¶æ€

| å®¹å™¨åç§° | é•œåƒ | çŠ¶æ€ | ç«¯å£æ˜ å°„ |
|---------|------|------|---------|
| `rag_kb_api` | self_rag_pipeline-api | âœ… Running | 8020:8020 |
| `rag_kb_frontend` | self_rag_pipeline-frontend | âœ… Running | 3003:3000 |
| `rag_kb_postgres` | postgres:15 | âœ… Running | 5435:5432 |
| `rag_kb_redis` | redis:7 | âœ… Running | 6389:6379 |

### 2. æœåŠ¡å¥åº·æ£€æŸ¥

#### âœ… Health Endpoint
```bash
GET http://localhost:8020/health
```
**ç»“æœ**ï¼š
```json
{
  "status": "ok"
}
```
**çŠ¶æ€**ï¼šâœ… é€šè¿‡

#### âš ï¸ Ready Endpoint
```bash
GET http://localhost:8020/ready
```
**ç»“æœ**ï¼š
```json
{
  "status": "degraded",
  "checks": {
    "database": {
      "status": "ok",
      "message": "connected"
    },
    "qdrant": {
      "status": "error",
      "message": "All connection attempts failed"
    },
    "es": {
      "status": "ok",
      "message": "using memory"
    }
  }
}
```
**çŠ¶æ€**ï¼šâš ï¸ é™çº§ï¼ˆQdrant é”™è¯¯ï¼Œä½†ä¸å½±å“åŠŸèƒ½ï¼‰

**è¯´æ˜**ï¼šç³»ç»Ÿå·²è¿ç§»åˆ° PostgreSQL + pgvectorï¼Œä¸å†éœ€è¦ Qdrantã€‚éœ€è¦æ›´æ–°é…ç½®ç§»é™¤ Qdrant æ£€æŸ¥ã€‚

### 3. ç³»ç»ŸæŒ‡æ ‡

```json
{
  "service": {
    "uptime_seconds": 66.4,
    "uptime_human": "1m 6s"
  },
  "config": {
    "llm_provider": "ollama",
    "llm_model": "qwen2.5:14b",
    "embedding_provider": "ollama",
    "embedding_model": "bge-m3",
    "embedding_dim": 1024,
    "rerank_provider": "ollama",
    "bm25_backend": "memory",
    "bm25_enabled": true,
    "es_index_mode": "shared"
  }
}
```
**çŠ¶æ€**ï¼šâœ… æ­£å¸¸

### 4. æ•°æ®åº“è¿æ¥æµ‹è¯•

#### PostgreSQL
```bash
psql -U kb -d kb -c "SELECT 1"
```
**ç»“æœ**ï¼šâœ… è¿æ¥æˆåŠŸ

#### Redis
```bash
redis-cli ping
```
**ç»“æœ**ï¼šâœ… PONG

### 5. API æ–‡æ¡£

**åœ°å€**ï¼šhttp://localhost:8020/docs  
**çŠ¶æ€**ï¼šâœ… å¯è®¿é—®ï¼ˆSwagger UIï¼‰

### 6. å‰ç«¯æœåŠ¡

**åœ°å€**ï¼šhttp://localhost:3003  
**çŠ¶æ€**ï¼šâš ï¸ HTTP 307ï¼ˆé‡å®šå‘ï¼Œå¯èƒ½æ­£å¸¸ï¼‰

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

| æµ‹è¯•é¡¹ | é€šè¿‡ | è­¦å‘Š | å¤±è´¥ |
|--------|------|------|------|
| å®¹å™¨å¯åŠ¨ | 4 | 0 | 0 |
| å¥åº·æ£€æŸ¥ | 1 | 1 | 0 |
| æ•°æ®åº“è¿æ¥ | 2 | 0 | 0 |
| API æ–‡æ¡£ | 1 | 0 | 0 |
| å‰ç«¯æœåŠ¡ | 0 | 1 | 0 |
| **æ€»è®¡** | **8** | **2** | **0** |

**é€šè¿‡ç‡**ï¼š80% (8/10)

## âš ï¸ å‘ç°çš„é—®é¢˜

### 1. Qdrant è¿æ¥é”™è¯¯ï¼ˆéé˜»å¡ï¼‰

**é—®é¢˜æè¿°**ï¼šç³»ç»Ÿä»åœ¨å°è¯•è¿æ¥ Qdrantï¼Œä½†å·²è¿ç§»åˆ° PostgreSQL + pgvectorã€‚

**å½±å“**ï¼šReady endpoint è¿”å› "degraded" çŠ¶æ€ï¼Œä½†ä¸å½±å“å®é™…åŠŸèƒ½ã€‚

**å»ºè®®ä¿®å¤**ï¼š
1. æ›´æ–°é…ç½®æ–‡ä»¶ï¼Œç§»é™¤ Qdrant ç›¸å…³é…ç½®
2. æ›´æ–°å¥åº·æ£€æŸ¥é€»è¾‘ï¼Œç§»é™¤ Qdrant æ£€æŸ¥
3. æ¸…ç†ä»£ç ä¸­çš„ Qdrant ä¾èµ–

### 2. å‰ç«¯ HTTP 307 å“åº”

**é—®é¢˜æè¿°**ï¼šå‰ç«¯è¿”å› HTTP 307 é‡å®šå‘ã€‚

**å½±å“**ï¼šéœ€è¦è¿›ä¸€æ­¥éªŒè¯å‰ç«¯æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

**å»ºè®®æ£€æŸ¥**ï¼š
1. æ£€æŸ¥å‰ç«¯æ—¥å¿—
2. åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—®
3. éªŒè¯ Next.js è·¯ç”±é…ç½®

### 3. Docker Hub ç½‘ç»œé—®é¢˜

**é—®é¢˜æè¿°**ï¼šæ— æ³•è¿æ¥åˆ° Docker Hub æ‹‰å–é•œåƒã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `--pull never` å¼ºåˆ¶ä½¿ç”¨æœ¬åœ°é•œåƒã€‚

**å»ºè®®**ï¼š
1. é…ç½® Docker é•œåƒåŠ é€Ÿå™¨
2. æˆ–æå‰æ‹‰å–æ‰€éœ€é•œåƒ

## ğŸ”§ é…ç½®ä¿¡æ¯

### ç¯å¢ƒå˜é‡
```bash
DATABASE_URL=postgresql+asyncpg://kb:kb@db:5432/kb
REDIS_URL=redis://redis:6379/0
ADMIN_TOKEN=your_admin_token_here
```

### æ¨¡å‹é…ç½®
- **LLM**ï¼šOllama - qwen2.5:14b
- **Embedding**ï¼šOllama - bge-m3 (1024ç»´)
- **Rerank**ï¼šOllama
- **BM25**ï¼šå†…å­˜æ¨¡å¼

## ğŸ“ åç»­ä»»åŠ¡

### é«˜ä¼˜å…ˆçº§
- [ ] ç§»é™¤ Qdrant ä¾èµ–ï¼Œæ›´æ–°å¥åº·æ£€æŸ¥
- [ ] éªŒè¯å‰ç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] æ›´æ–° ADMIN_TOKEN ä¸ºçœŸå®å€¼

### ä¸­ä¼˜å…ˆçº§
- [ ] æµ‹è¯• Admin APIï¼ˆåˆ›å»ºç§Ÿæˆ·ã€API Keyï¼‰
- [ ] æµ‹è¯•çŸ¥è¯†åº“ç®¡ç†åŠŸèƒ½
- [ ] æµ‹è¯•æ–‡æ¡£ä¸Šä¼ å’Œæ£€ç´¢åŠŸèƒ½
- [ ] æµ‹è¯• OpenAI å…¼å®¹æ¥å£

### ä½ä¼˜å…ˆçº§
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] å‹åŠ›æµ‹è¯•
- [ ] é…ç½® Docker é•œåƒåŠ é€Ÿ
- [ ] ä¼˜åŒ–å®¹å™¨å¯åŠ¨æ—¶é—´

## ğŸ‰ ç»“è®º

**æ€»ä½“çŠ¶æ€**ï¼šâœ… åŸºç¡€æœåŠ¡å¯åŠ¨æˆåŠŸ

ä¸»è¦æœåŠ¡ï¼ˆAPIã€æ•°æ®åº“ã€Redisï¼‰å‡å·²æ­£å¸¸å¯åŠ¨å¹¶é€šè¿‡åŸºæœ¬æµ‹è¯•ã€‚è™½ç„¶å­˜åœ¨ Qdrant ç›¸å…³è­¦å‘Šï¼Œä½†ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½ã€‚ç³»ç»Ÿå·²ä» Qdrant è¿ç§»åˆ° PostgreSQL + pgvectorï¼Œæ¶æ„æ›´åŠ ç®€æ´ã€‚

### å¯ç”¨çš„æœåŠ¡

âœ… **API æœåŠ¡**ï¼šhttp://localhost:8020  
âœ… **API æ–‡æ¡£**ï¼šhttp://localhost:8020/docs  
âš ï¸ **å‰ç«¯æœåŠ¡**ï¼šhttp://localhost:3003  
âœ… **PostgreSQL**ï¼šlocalhost:5435  
âœ… **Redis**ï¼šlocalhost:6389  

### ä¸‹ä¸€æ­¥

1. åœ¨æµè§ˆå™¨ä¸­è®¿é—® http://localhost:8020/docs éªŒè¯ API æ–‡æ¡£
2. åœ¨æµè§ˆå™¨ä¸­è®¿é—® http://localhost:3003 éªŒè¯å‰ç«¯ç•Œé¢
3. ä½¿ç”¨æ–‡æ¡£ä¸­çš„ç¤ºä¾‹è¿›è¡ŒåŠŸèƒ½æµ‹è¯•
4. æ ¹æ®éœ€è¦è°ƒæ•´é…ç½®å’Œéƒ¨ç½²

---

**æµ‹è¯•å®Œæˆæ—¶é—´**ï¼š2026-01-15 11:46  
**æµ‹è¯•è€—æ—¶**ï¼šçº¦ 5 åˆ†é’Ÿ  
**æµ‹è¯•å·¥å…·**ï¼šcurl, docker compose, bash
